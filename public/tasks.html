<!DOCTYPE html>
<html lang="ru" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Задачи</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/htmx.org@1.9.12"></script>
</head>
<body class="h-full bg-gray-50 flex">
  <div hx-get="/components/sidebar.html" hx-trigger="load" hx-swap="innerHTML"></div>

  <div class="flex-1 p-10 overflow-auto">
    <div class="flex justify-between items-center mb-8">
      <h2 class="text-3xl font-bold">Задачи</h2>
      <button class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded font-medium"
              hx-get="/components/task-create-modal.html" 
              hx-target="#modal" hx-swap="innerHTML">
        + Новая задача
      </button>
    </div>

    <div id="tasks-list" 
         hx-get="/api/tasks" 
         hx-trigger="load, taskCreated from:body" 
         hx-swap="innerHTML"
         class="space-y-6">
      <!-- Задачи подгрузятся сюда -->
    </div>
  </div>

  <div id="modal" class="fixed inset-0 z-50"></div>

  <!-- Подключаем шаблон задачи -->
  <script src="/components/task-item.html"></script>
  <script>
    // Автоматически рендерим задачи
    document.body.addEventListener('htmx:afterSwap', function(evt) {
      if (evt.detail.target.id === 'tasks-list') {
        const tasks = JSON.parse(evt.detail.xhr.response);
        evt.detail.target.innerHTML = tasks.map(renderTask).join("") || 
          "<p class='text-gray-500'>Задач пока нет</p>";
      }
    });
  </script>
</body>
</html>
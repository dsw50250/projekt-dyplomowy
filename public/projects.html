<!DOCTYPE html>
<html lang="ru" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Проекты</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/htmx.org@1.9.12"></script>
</head>
<body class="h-full bg-gray-50 flex">
  <div hx-get="/components/sidebar.html" hx-trigger="load" hx-swap="innerHTML"></div>

  <div class="flex-1 p-10">
    <div class="flex justify-between items-center mb-8">
      <h2 class="text-3xl font-bold">Проекты</h2>
      <button class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded font-medium"
              hx-get="/components/project-create-modal.html" 
              hx-target="#modal" hx-swap="innerHTML">
        + Новый проект
      </button>
    </div>

    <div id="projects-list" 
         hx-get="/api/projects" 
         hx-trigger="load" 
         hx-swap="innerHTML" 
         class="space-y-4">
    </div>
  </div>

  <div id="modal" class="fixed inset-0 z-50"></div>

  <script>
    document.body.addEventListener('htmx:afterSwap', function(evt) {
      if (evt.detail.target.id === 'projects-list') {
        const projects = JSON.parse(evt.detail.xhr.response);
        if (projects.length === 0) {
          evt.detail.target.innerHTML = "<p class='text-gray-500'>Проектов пока нет</p>";
          return;
        }
        evt.detail.target.innerHTML = projects.map(p => `
          <div class="bg-white p-6 rounded-lg shadow">
            <h3 class="text-xl font-semibold">${p.name}</h3>
            <p class="text-gray-600 mt-2">${p.description || "Без описания"}</p>
            <p class="text-sm text-gray-500 mt-3">Менеджер: ${p.User?.name || "—"}</p>
          </div>
        `).join("");
      }
    });
  </script>
</body>
</html>